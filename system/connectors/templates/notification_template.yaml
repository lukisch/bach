# Template-Konfiguration fuer Notification-Channels (nur Senden)
# ================================================================
#
# Notification-Channels sind EINFACHER als volle Connectors:
# - Nur Senden (kein Polling, kein Empfang)
# - Keys aus user/secrets/secrets.json (NICHT aus bach.db!)
# - Verwendet hub/notify.py Handler
#
# Verwendung: bach notify send <channel> "Nachricht"
#
# Aktuell unterstuetzte Channels:
#   telegram  - Telegram Bot API (AKTIV, getestet)
#   discord   - Discord Webhook
#   slack     - Slack Webhook
#   webhook   - Generischer HTTP Webhook
#   email     - SMTP Email
#
# Neue Notification-Channels hinzufuegen:
# ========================================
#
# 1. Key in user/secrets/secrets.json eintragen:
#    {
#      "mein_channel": {
#        "api_token": "...",
#        "endpoint": "..."
#      }
#    }
#
# 2. Channel in hub/notify.py registrieren:
#    a) CHANNELS-Tuple erweitern (Zeile ~39)
#    b) _dispatch() Methode erweitern (neues elif)
#    c) _send_mein_channel() Methode hinzufuegen
#
# 3. Channel in bach.db registrieren:
#    bach notify setup mein_channel [endpoint]
#    (oder per SQL: INSERT INTO connections ...)
#
# 4. Testen:
#    bach notify test mein_channel
#
# WICHTIG: Keys gehoeren IMMER in user/secrets/secrets.json,
#          NIEMALS in die bach.db (wird mit-gebuildet!)

# ================================================================
# Telegram Notification Channel (Referenz-Implementierung)
# ================================================================

channel_name: telegram
channel_type: notification
display_name: Telegram Push-Benachrichtigung

secrets_schema:
  telegram:
    bot_token: "Bot-Token von @BotFather"
    chat_id: "Ziel Chat-ID"
    bot_name: "Optionaler Anzeigename"

db_registration:
  name: notify_telegram
  type: telegram
  category: notification
  auth_type: secrets_file
  endpoint: "user/secrets/secrets.json"

dispatch_code: |
  def _send_telegram(self, text, auth_config=""):
      import urllib.request, urllib.parse
      secrets = self._load_secrets()
      tg = secrets.get("telegram", {})
      bot_token = tg.get("bot_token", "")
      chat_id = tg.get("chat_id", "")
      if not bot_token or not chat_id:
          return False
      url = f"https://api.telegram.org/bot{bot_token}/sendMessage"
      data = urllib.parse.urlencode({
          "chat_id": chat_id,
          "text": text,
          "parse_mode": "Markdown"
      }).encode("utf-8")
      req = urllib.request.Request(url, data=data)
      with urllib.request.urlopen(req, timeout=10) as resp:
          return resp.status < 400

# Partner-Tagging (Konvention fuer Notification-Nachrichten):
#   [MCMC]     - Server-Status, Fortschritt, Fertigmeldung
#   [ZENODO]   - DOI-Vergabe, Upload-Bestaetigung
#   [LINKEDIN] - Post publiziert
#   [CI/CD]    - Build-Status, Test-Ergebnisse
#   [BACH]     - Interne System-Meldungen
#   [AGENT]    - Agent-Ergebnisse (Schwarm, Marble-Run)
