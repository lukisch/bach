<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token-Dashboard | BACH</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <style>
        :root {
            --accent-glow: rgba(233, 69, 96, 0.3);
        }

        .token-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Premium Stats Grid */
        .stats-grid-premium {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            background: var(--bg-panel);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-box::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent);
            opacity: 0.5;
        }

        .stat-box.green::after {
            background: var(--success);
        }

        .stat-box.blue::after {
            background: var(--accent-blue);
        }

        .stat-box.orange::after {
            background: var(--warning);
        }

        .stat-box .value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 0.5rem;
            display: block;
        }

        .stat-box .label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-box.accent .value {
            color: var(--accent);
        }

        .stat-box.green .value {
            color: var(--success);
        }

        .stat-box.blue .value {
            color: var(--accent-blue);
        }

        .stat-box.orange .value {
            color: var(--warning);
        }

        /* Table Styles */
        .premium-table-container {
            overflow-x: auto;
            background: var(--bg-panel);
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .premium-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        .premium-table th {
            padding: 1.25rem 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            color: var(--text-muted);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--border);
        }

        .premium-table td {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .premium-table tr:last-child td {
            border-bottom: none;
        }

        .premium-table tr:hover {
            background: rgba(233, 69, 96, 0.05);
        }

        .model-name {
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-val {
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: 700;
            color: var(--success);
            font-size: 1.1rem;
        }

        .price-usd {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-left: 8px;
        }

        /* Calculator Section */
        .calc-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 2rem;
        }

        .calc-card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        select,
        input {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .calc-result {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.1) 0%, rgba(74, 144, 217, 0.1) 100%);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .calc-result .cost-big {
            font-size: 3rem;
            font-weight: 800;
            color: var(--success);
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
            margin-bottom: 1rem;
        }

        .calc-result .details {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Actor Cards */
        .actors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .actor-card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .actor-card:hover {
            border-color: var(--accent-blue);
            transform: scale(1.02);
        }

        .actor-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .actor-name {
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .actor-status {
            font-size: 0.8rem;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .status-paid {
            background: rgba(233, 69, 96, 0.15);
            color: var(--accent-light);
        }

        .status-free {
            background: rgba(74, 222, 128, 0.15);
            color: var(--success);
        }

        /* Helpers */
        .badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            vertical-align: middle;
            margin-left: 8px;
        }

        .badge-live {
            background: var(--success);
            color: #000;
        }

        .header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <header class="main-header" id="main-header"></header>

    <main class="main-content">
        <div class="token-container">
            <div class="header-flex">
                <div>
                    <h1>üîã Token-Dashboard</h1>
                    <p style="color: var(--text-muted); margin-top: 5px;">Kosten√ºberwachung & Modell-Vergleich</p>
                </div>
                <div style="text-align: right;">
                    <div id="priceDate" style="font-size: 0.85rem; color: var(--text-muted);">Stand: l√§dt...</div>
                    <button class="btn btn-secondary" onclick="loadTokenData()"
                        style="margin-top: 10px; padding: 5px 15px;">
                        üîÑ Aktualisieren
                    </button>
                </div>
            </div>

            <!-- Global Stats -->
            <div class="stats-grid-premium">
                <div class="stat-box blue">
                    <span class="value" id="exchangeRate">0.0000</span>
                    <span class="label">EUR/USD Kurs</span>
                </div>
                <div class="stat-box accent">
                    <span class="value" id="totalCost">‚Ç¨0.00</span>
                    <span class="label">Kosten (30 Tage)</span>
                </div>
                <div class="stat-box orange">
                    <span class="value" id="totalTokens">0</span>
                    <span class="label">Tokens (Gesamt)</span>
                </div>
                <div class="stat-box green">
                    <span class="value" id="topModel">Claude Opus 4.5</span>
                    <span class="label">Meistgenutzt</span>
                </div>
            </div>

            <!-- Model Prices -->
            <div class="card" style="margin-bottom: 2rem;">
                <h2>üí∞ Modell-Preise <span class="badge badge-live">LIVE</span></h2>
                <div class="premium-table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>Modell</th>
                                <th>Input / 1M Tokens</th>
                                <th>Output / 1M Tokens</th>
                                <th>Kosten pro 1K (In/Out)</th>
                            </tr>
                        </thead>
                        <tbody id="priceTable">
                            <!-- JS will populate -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Calculator -->
            <div class="calc-grid">
                <div class="calc-card">
                    <h2>üßÆ Kosten-Rechner</h2>
                    <div class="form-group">
                        <label>Aktion ausw√§hlen:</label>
                        <select id="actionSelect" onchange="calculateCost()">
                            <option value="500">Einfache Antwort (~500 Tokens)</option>
                            <option value="1500">Normaler Chat (~1.500 Tokens)</option>
                            <option value="5000">Kleine Analyse (~5.000 Tokens)</option>
                            <option value="15000">Grosse Migration (~15.000 Tokens)</option>
                            <option value="50000">Komplexes Refactoring (~50.000 Tokens)</option>
                            <option value="custom">Eigene Anzahl...</option>
                        </select>
                    </div>
                    <div id="customTokensGroup" class="form-group" style="display: none;">
                        <label>Eigene Token-Anzahl:</label>
                        <input type="number" id="customTokens" placeholder="z.B. 10000" oninput="calculateCost()">
                    </div>
                    <div class="form-group">
                        <label>Modell f√ºr Kalkulation:</label>
                        <select id="modelSelect" onchange="calculateCost()">
                            <!-- JS will populate -->
                        </select>
                    </div>
                </div>
                <div class="calc-result">
                    <div class="cost-big" id="calcCost">‚Ç¨0.0000</div>
                    <div class="details" id="calcBreakdown">W√§hle eine Aktion</div>
                </div>
            </div>

            <h2 style="margin: 3rem 0 1.5rem;">üë• Die Akteure</h2>
            <div class="actors-grid">
                <div class="actor-card">
                    <div class="actor-icon">üß†</div>
                    <div class="actor-name">CLAUDE AI</div>
                    <span class="actor-status status-paid">BEZAHLT</span>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Opus 4.5, Sonnet 4, Haiku
                        3.5</p>
                </div>
                <div class="actor-card">
                    <div class="actor-icon">üíé</div>
                    <div class="actor-name">GEMINI AI</div>
                    <span class="actor-status status-paid">BEZAHLT</span>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Flash 2.0, Pro 2.0</p>
                </div>
                <div class="actor-card">
                    <div class="actor-icon">üë§</div>
                    <div class="actor-name">USER</div>
                    <span class="actor-status status-free">GRATIS</span>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Manuelle Arbeit = 0
                        Tokens.</p>
                </div>
                <div class="actor-card">
                    <div class="actor-icon">‚öôÔ∏è</div>
                    <div class="actor-name">SCRIPTS</div>
                    <span class="actor-status status-free">GRATIS</span>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Automatisierung spart
                        Tokens.</p>
                </div>
                <div class="actor-card">
                    <div class="actor-icon">ü§ñ</div>
                    <div class="actor-name">OLLAMA (Lokal)</div>
                    <span class="actor-status status-free">GRATIS</span>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Lokale Modelle, 0 Kosten.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div>BACH v1.1 | Token Management System</div>
        <div id="status-text">System bereit</div>
    </footer>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/nav.js"></script>
    <script>
        // Modell-Preise (Stand: 2026-01-28)
        let config = {
            currency: { exchange_rate: 0.85, rate_date: "2026-01-28" },
            models: {
                "claude-opus-4-5": { name: "Claude Opus 4.5", input_per_mtok_usd: 15.00, output_per_mtok_usd: 75.00 },
                "claude-sonnet-4": { name: "Claude Sonnet 4", input_per_mtok_usd: 3.00, output_per_mtok_usd: 15.00 },
                "claude-3-5-sonnet": { name: "Claude 3.5 Sonnet", input_per_mtok_usd: 3.00, output_per_mtok_usd: 15.00 },
                "claude-haiku-3-5": { name: "Claude Haiku 3.5", input_per_mtok_usd: 0.80, output_per_mtok_usd: 4.00 },
                "gemini-2-0-flash": { name: "Gemini 2.0 Flash", input_per_mtok_usd: 0.10, output_per_mtok_usd: 0.40 },
                "gemini-2-0-pro": { name: "Gemini 2.0 Pro", input_per_mtok_usd: 1.25, output_per_mtok_usd: 10.00 },
                "gpt-4o": { name: "GPT-4o", input_per_mtok_usd: 2.50, output_per_mtok_usd: 10.00 },
                "deepseek-chat": { name: "DeepSeek V3", input_per_mtok_usd: 0.14, output_per_mtok_usd: 0.28 },
                "ollama-local": { name: "Ollama (Lokal)", input_per_mtok_usd: 0.00, output_per_mtok_usd: 0.00 }
            }
        };

        async function loadTokenData() {
            try {
                const response = await fetch('/api/tokens/usage');
                const data = await response.json();

                if (data.success) {
                    config.currency.exchange_rate = data.exchange_rate;
                    config.currency.rate_date = data.rate_date;

                    document.getElementById('exchangeRate').textContent = data.exchange_rate.toFixed(4);
                    document.getElementById('totalCost').textContent = '‚Ç¨' + data.total_cost_eur;
                    document.getElementById('totalTokens').textContent = data.total_tokens.toLocaleString();

                    const topModelId = data.top_model;
                    const topModelName = config.models[topModelId]?.name || topModelId || '-';
                    document.getElementById('topModel').textContent = topModelName;
                    document.getElementById('priceDate').textContent = 'Stand: ' + data.rate_date;
                }
            } catch (e) {
                console.error('API Error:', e);
                document.getElementById('priceDate').textContent = 'API Offline';
            }
            updateUI();
        }

        function updateUI() {
            const rate = config.currency.exchange_rate;

            // Populate Price Table
            const tbody = document.getElementById('priceTable');
            tbody.innerHTML = '';

            const modelSelect = document.getElementById('modelSelect');
            const currentSelected = modelSelect.value;
            modelSelect.innerHTML = '';

            for (const [id, model] of Object.entries(config.models)) {
                const inEur = model.input_per_mtok_usd * rate;
                const outEur = model.output_per_mtok_usd * rate;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><div class="model-name">${model.name}</div></td>
                    <td><span class="price-val">‚Ç¨${inEur.toFixed(2)}</span><span class="price-usd">($${model.input_per_mtok_usd.toFixed(2)})</span></td>
                    <td><span class="price-val">‚Ç¨${outEur.toFixed(2)}</span><span class="price-usd">($${model.output_per_mtok_usd.toFixed(2)})</span></td>
                    <td style="color: var(--text-muted); font-size: 0.8rem;">
                        In: ‚Ç¨${(inEur / 1000).toFixed(4)} | Out: ‚Ç¨${(outEur / 1000).toFixed(4)}
                    </td>
                `;
                tbody.appendChild(row);

                // Populate Model Select
                const opt = document.createElement('option');
                opt.value = id;
                opt.textContent = model.name;
                if (id === currentSelected || (!currentSelected && id === 'claude-opus-4-5')) opt.selected = true;
                modelSelect.appendChild(opt);
            }

            calculateCost();
        }

        function calculateCost() {
            const selectAction = document.getElementById('actionSelect');
            const customTokens = document.getElementById('customTokens');
            const modelKey = document.getElementById('modelSelect').value;
            const model = config.models[modelKey];
            const rate = config.currency.exchange_rate;

            const tokens = selectAction.value === 'custom' ? parseInt(customTokens.value) || 0 : parseInt(selectAction.value);
            document.getElementById('customTokensGroup').style.display = selectAction.value === 'custom' ? 'block' : 'none';

            // Assumption: 40% Input, 60% Output
            const inCost = (tokens * 0.4 / 1000000) * model.input_per_mtok_usd * rate;
            const outCost = (tokens * 0.6 / 1000000) * model.output_per_mtok_usd * rate;
            const total = inCost + outCost;

            document.getElementById('calcCost').textContent = '‚Ç¨' + total.toFixed(4);
            document.getElementById('calcBreakdown').innerHTML = `
                ${tokens.toLocaleString()} Tokens (40/60 Split)<br>
                Modell: ${model.name}<br>
                In: ‚Ç¨${inCost.toFixed(5)} | Out: ‚Ç¨${outCost.toFixed(5)}
            `;
        }

        document.addEventListener('DOMContentLoaded', loadTokenData);
    </script>
</body>

</html>