<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BACH - Wiki</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <style>
        .help-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1.5rem;
            height: calc(100vh - 140px);
        }

        .help-sidebar {
            background: var(--bg-panel);
            border-radius: 8px;
            padding: 1rem;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .help-content {
            background: var(--bg-panel);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .search-box {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-card);
            color: var(--text);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent);
        }

        .help-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .help-item {
            padding: 0.6rem 0.8rem;
            margin: 2px 0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            transition: background 0.2s;
            font-size: 0.9rem;
        }

        .help-item:hover {
            background: var(--bg-card);
        }

        .help-item.active {
            background: var(--accent);
            color: white;
        }

        .help-item .icon {
            font-size: 1rem;
        }

        .help-item .name {
            flex: 1;
        }

        .help-item .size {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .help-item.active .size {
            color: rgba(255, 255, 255, 0.7);
        }

        .help-viewer {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            white-space: pre-wrap;
            color: var(--text);
        }

        .help-title {
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .help-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .help-meta code {
            background: var(--bg-card);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
        }

        .no-content {
            text-align: center;
            color: var(--text-muted);
            padding: 3rem 1rem;
        }

        .no-content .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .category-header {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-muted);
            padding: 0.8rem 0.8rem 0.3rem;
            margin-top: 0.5rem;
            letter-spacing: 0.05em;
        }

        /* Collapsible Folders */
        .folder-header {
            font-size: 0.75rem;
            color: var(--text);
            padding: 0.5rem 0.8rem;
            margin-top: 0.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .folder-header:hover {
            background: var(--bg-card);
        }

        .folder-header .folder-toggle {
            font-size: 0.65rem;
            transition: transform 0.2s;
            width: 12px;
        }

        .folder-header.collapsed .folder-toggle {
            transform: rotate(-90deg);
        }

        .folder-children {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .folder-children.collapsed {
            max-height: 0 !important;
        }

        .help-item.is-folder {
            font-weight: 500;
            color: var(--accent);
        }

        .help-item.is-file {
            font-size: 0.85rem;
        }

        .stats-bar {
            display: flex;
            gap: 1.5rem;
            padding: 0.8rem 1rem;
            background: var(--bg-panel);
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            border: 1px solid var(--border);
        }

        .stats-bar span {
            color: var(--text-muted);
        }

        .stats-bar strong {
            color: var(--accent);
        }

        .highlight {
            background: var(--accent);
            color: white;
            padding: 0 2px;
            border-radius: 2px;
        }

        /* Editor Mode */
        .dev-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .dev-toggle input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .help-editor {
            width: 100%;
            height: calc(100% - 120px);
            min-height: 400px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            padding: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            resize: none;
        }

        .help-editor:focus {
            outline: none;
            border-color: var(--accent);
        }

        .editor-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .editor-status {
            margin-left: auto;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-status.saved {
            color: var(--success);
        }

        .editor-status.modified {
            color: var(--warning);
        }

        .editor-status.error {
            color: var(--error);
        }

        .new-file-input {
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
            font-size: 0.85rem;
            width: 200px;
        }

        .toolbar {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            color: var(--text);
        }

        .toolbar-btn:hover {
            background: var(--accent);
            color: white;
        }

        @media (max-width: 800px) {
            .help-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .help-sidebar {
                max-height: 250px;
            }
        }
    </style>
</head>

<body>
    <header class="main-header" id="main-header"></header>

    <main class="main-content">
        <h1 style="margin-bottom: 1rem;">üìñ Wiki</h1>

        <div class="stats-bar" id="stats">
            <span>Dateien: <strong id="file-count">-</strong></span>
            <span>Gesamt: <strong id="total-size">-</strong></span>
            <span style="margin-left: auto;">
                <label class="dev-toggle">
                    <input type="checkbox" id="dev-mode" onchange="toggleDevMode()">
                    Entwickler-Modus
                </label>
            </span>
        </div>

        <div class="help-container">
            <aside class="help-sidebar">
                <input type="text" class="search-box" id="search" placeholder="üîç Suchen..." autocomplete="off">
                <ul class="help-list" id="help-list">
                    <li class="no-content">Lade...</li>
                </ul>
            </aside>

            <section class="help-content" id="help-content">
                <div class="no-content">
                    <div class="icon">üìñ</div>
                    <p>Wiki-Thema ausw√§hlen</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem;">
                        Wissen und Dokumentation
                    </p>
                </div>
            </section>

            <!-- New File Button (nur im Dev-Mode) -->
            <div id="new-file-panel" style="display: none; margin-top: 1rem;">
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="text" id="new-file-name" class="new-file-input" placeholder="Neuer Dateiname...">
                    <button class="btn btn-primary" onclick="createNewFile()">Erstellen</button>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/nav.js"></script>
    <script>
        let helpFiles = [];
        let currentFile = null;
        let devMode = false;
        let originalContent = '';
        let isModified = false;

        const icons = {
            'startup': 'üöÄ', 'shutdown': 'üõë', 'tasks': 'üìã', 'scan': 'üîç',
            'scanner': 'üîç', 'messages': 'üí¨', 'gui': 'üñ•Ô∏è', 'daemon': '‚öôÔ∏è',
            'tools': 'üîß', 'connections': 'üîó', 'actors': 'üé≠', 'partners': 'ü§ù',
            'memory': 'üß†', 'lessons': 'üìö', 'backup': 'üíæ', 'steuer': 'üìä',
            'anbieter': 'üè™', 'workflow': 'üîÑ', 'coding': 'üíª', 'bugfix': 'üêõ',
            'planning': 'üìÖ', 'practices': 'üìê', 'architecture': 'üèóÔ∏è',
            'docs': 'üìù',
            'default': 'üìÑ'
        };

        // Wiki-Unterordner Icons
        const wikiIcons = {
            'steuer': 'üìä',
            'gesundheit': 'üè•',
            'haushalt': 'üè†',
            'default': 'üìÅ'
        };

        function getIcon(name) {
            // Wiki-Unterordner
            if (name.startsWith('wiki/')) {
                const parts = name.split('/');
                if (parts.length >= 2) {
                    const folder = parts[1];
                    if (parts.length === 2) {
                        // wiki/datei
                        return 'üìñ';
                    } else {
                        // wiki/ordner/datei
                        return wikiIcons[folder] || wikiIcons['default'];
                    }
                }
                return 'üìñ';
            }
            return icons[name] || icons['default'];
        }

        // Status
        async function loadStatus() {
            try {
                const data = await api.get('/api/status');
                document.getElementById('status-dot').classList.add('online');
                document.getElementById('status-text').textContent = 'Online';
            } catch (e) {
                document.getElementById('status-dot').classList.add('offline');
                document.getElementById('status-text').textContent = 'Offline';
            }
        }

        async function loadHelpList() {
            try {
                const data = await api.get('/api/help');
                helpFiles = data.files || [];

                document.getElementById('file-count').textContent = data.count;
                document.getElementById('total-size').textContent = formatSize(data.total_size);

                renderHelpList(helpFiles);
            } catch (err) {
                console.error('Fehler:', err);
                document.getElementById('help-list').innerHTML =
                    '<li class="no-content">Fehler beim Laden</li>';
            }
        }

        function renderHelpList(files) {
            const list = document.getElementById('help-list');

            if (!files.length) {
                list.innerHTML = '<li class="no-content">Keine Dateien</li>';
                return;
            }

            const categories = {
                'System': ['startup', 'shutdown', 'gui', 'daemon', 'backup', 'distribution'],
                'Arbeit': ['tasks', 'scan', 'scanner', 'messages', 'workflow'],
                'Wissen': ['memory', 'lessons', 'sources', 'docs'],
                'Integration': ['tools', 'connections', 'actors', 'partners', 'injectors'],
                'Entwicklung': ['coding', 'bugfix', 'builder', 'planning', 'practices', 'architecture', 'test'],
                'Spezial': ['steuer', 'anbieter']
            };

            const categorized = {};
            const wikiFiles = [];
            const wikiSubFolders = {};
            const uncategorized = [];

            for (const file of files) {
                // NUR Wiki-Dateien
                if (file.type === 'wiki') {
                    wikiFiles.push(file);
                    continue;
                }
                if (file.type === 'wiki_sub') {
                    const folder = file.folder || 'unknown';
                    if (!wikiSubFolders[folder]) wikiSubFolders[folder] = [];
                    wikiSubFolders[folder].push(file);
                    continue;
                }
            }

            let html = '';

            // Wiki-Sektion
            if (wikiFiles.length > 0 || Object.keys(wikiSubFolders).length > 0) {
                html += `<li class="category-header">üìñ Wiki</li>`;

                // Wiki-Root-Dateien (mit Datei-Icon)
                for (const file of wikiFiles) {
                    html += renderHelpItem(file, 1, true);
                }

                // Wiki-Unterordner (sortiert, einklappbar)
                const sortedFolders = Object.keys(wikiSubFolders).sort();
                for (const folder of sortedFolders) {
                    const folderFiles = wikiSubFolders[folder];
                    const folderIcon = wikiIcons[folder] || 'üìÅ';
                    const fileCount = folderFiles.length;
                    const folderId = 'folder-' + folder.replace(/[^a-z0-9]/gi, '_');

                    // Einklappbarer Ordner-Header
                    html += `
                        <li class="folder-header" onclick="toggleFolder('${folderId}')" id="${folderId}-header">
                            <span class="folder-toggle">‚ñº</span>
                            <span>${folderIcon}</span>
                            <span style="flex: 1;">${folder}/</span>
                            <span style="font-size: 0.7rem; color: var(--text-muted);">${fileCount}</span>
                        </li>
                        <div class="folder-children" id="${folderId}-children">
                    `;

                    // Dateien nach Pfad sortieren und anzeigen
                    const sortedFiles = [...folderFiles].sort((a, b) => a.name.localeCompare(b.name));

                    for (const file of sortedFiles) {
                        const depth = (file.depth || 1) + 1;
                        html += renderHelpItem(file, depth, true);
                    }

                    html += `</div>`;
                }
            }

            list.innerHTML = html;

            list.querySelectorAll('.help-item').forEach(item => {
                item.addEventListener('click', () => loadHelpFile(item.dataset.name));
            });

            // Restore collapsed folders state
            restoreCollapsedState();
        }

        function renderHelpItem(file, depth = 0, isFile = false) {
            const active = currentFile === file.name ? 'active' : '';
            const indentPx = depth * 12; // 12px pro Ebene
            const indent = indentPx > 0 ? `style="padding-left: ${indentPx + 8}px;"` : '';
            const fileClass = isFile ? 'is-file' : '';

            // Display-Name: nur letzter Teil des Pfads
            let displayName = file.name;
            if (file.type === 'wiki_sub' || file.type === 'wiki') {
                displayName = file.name.split('/').pop();
            }

            // Icon: Dateien bekommen Dokument-Icon
            const icon = isFile ? 'üìÑ' : getIcon(file.name);

            return `
                <li class="help-item ${active} ${fileClass}" data-name="${file.name}" ${indent}>
                    <span class="icon">${icon}</span>
                    <span class="name">${displayName}</span>
                    <span class="size">${formatSize(file.size)}</span>
                </li>
            `;
        }

        // Folder toggle function
        function toggleFolder(folderId) {
            const header = document.getElementById(folderId + '-header');
            const children = document.getElementById(folderId + '-children');

            if (!header || !children) return;

            const isCollapsed = header.classList.contains('collapsed');

            if (isCollapsed) {
                // Expand
                header.classList.remove('collapsed');
                children.classList.remove('collapsed');
                children.style.maxHeight = children.scrollHeight + 'px';
            } else {
                // Collapse
                header.classList.add('collapsed');
                children.style.maxHeight = children.scrollHeight + 'px';
                // Force reflow
                children.offsetHeight;
                children.classList.add('collapsed');
            }

            // Zustand speichern (invertiert: speichere expandierte Ordner)
            const expandedFolders = JSON.parse(localStorage.getItem('wiki-expanded-folders') || '[]');
            if (isCollapsed) {
                // War collapsed, jetzt expanded -> zu expandedFolders hinzuf√ºgen
                if (!expandedFolders.includes(folderId)) expandedFolders.push(folderId);
            } else {
                // War expanded, jetzt collapsed -> aus expandedFolders entfernen
                const idx = expandedFolders.indexOf(folderId);
                if (idx > -1) expandedFolders.splice(idx, 1);
            }
            localStorage.setItem('wiki-expanded-folders', JSON.stringify(expandedFolders));
        }

        // Restore collapsed state (Wiki: default collapsed)
        function restoreCollapsedState() {
            // Wiki-Ordner: Default eingeklappt, au√üer explizit ausgeklappt
            const expandedFolders = JSON.parse(localStorage.getItem('wiki-expanded-folders') || '[]');

            // Alle folder-header finden und default einklappen
            document.querySelectorAll('.folder-header').forEach(header => {
                const folderId = header.id.replace('-header', '');
                const children = document.getElementById(folderId + '-children');

                if (!children) return;

                // Default: eingeklappt, au√üer in expandedFolders
                if (!expandedFolders.includes(folderId)) {
                    header.classList.add('collapsed');
                    children.classList.add('collapsed');
                }
            });
        }

        async function loadHelpFile(name) {
            // Warnung bei ungespeicherten Aenderungen
            if (isModified && devMode) {
                if (!confirm('Ungespeicherte Aenderungen verwerfen?')) return;
            }

            currentFile = name;
            isModified = false;

            document.querySelectorAll('.help-item').forEach(item => {
                item.classList.toggle('active', item.dataset.name === name);
            });

            const content = document.getElementById('help-content');
            content.innerHTML = '<div class="no-content">Lade...</div>';

            try {
                const data = await api.get(`/api/help/${name}`);
                originalContent = data.content;

                // Wiki-Dateien sind immer editierbar, Help nur im Entwickler-Modus
                const isWikiFile = data.type === 'wiki' || data.type === 'wiki_sub';
                const canEdit = isWikiFile || devMode;

                if (canEdit) {
                    renderEditor(data, isWikiFile);
                } else {
                    renderViewer(data);
                }
            } catch (err) {
                content.innerHTML = '<div class="no-content">Fehler beim Laden</div>';
            }
        }

        function renderViewer(data) {
            const content = document.getElementById('help-content');
            const searchTerm = document.getElementById('search').value.toLowerCase();
            let text = escapeHtml(data.content);

            if (searchTerm.length >= 2) {
                const regex = new RegExp(`(${escapeRegex(searchTerm)})`, 'gi');
                text = text.replace(regex, '<span class="highlight">$1</span>');
            }

            content.innerHTML = `
                <div class="help-title">${getIcon(data.name)} ${data.name}</div>
                <div class="help-meta">
                    Groesse: ${formatSize(data.size)} |
                    CLI: <code>bach --help ${data.name}</code>
                </div>
                <div class="help-viewer">${text}</div>
            `;
        }

        function renderEditor(data, isWiki = false) {
            const content = document.getElementById('help-content');
            const typeLabel = isWiki ? 'üìñ Wiki' : 'üìÑ Help';

            content.innerHTML = `
                <div class="help-title">${getIcon(data.name)} ${data.name} <span style="font-size: 0.7rem; color: var(--text-muted);">(${typeLabel})</span></div>
                <div class="toolbar">
                    <button class="toolbar-btn" onclick="insertTemplate('heading')"># Ueberschrift</button>
                    <button class="toolbar-btn" onclick="insertTemplate('section')">== Sektion ==</button>
                    <button class="toolbar-btn" onclick="insertTemplate('list')">- Liste</button>
                    <button class="toolbar-btn" onclick="insertTemplate('code')">\`Code\`</button>
                    <button class="toolbar-btn" onclick="insertTemplate('note')">[HINWEIS]</button>
                </div>
                <textarea class="help-editor" id="editor" onkeyup="checkModified()">${escapeHtml(data.content)}</textarea>
                <div class="editor-actions">
                    <button class="btn btn-primary" onclick="saveFile()">Speichern</button>
                    <button class="btn btn-secondary" onclick="revertFile()">Zuruecksetzen</button>
                    <button class="btn btn-secondary" onclick="deleteFile()" style="background: var(--error);">Loeschen</button>
                    <div class="editor-status" id="editor-status"></div>
                </div>
            `;
        }

        function checkModified() {
            const editor = document.getElementById('editor');
            if (!editor) return;

            isModified = editor.value !== originalContent;
            const status = document.getElementById('editor-status');

            if (isModified) {
                status.textContent = 'Geaendert';
                status.className = 'editor-status modified';
            } else {
                status.textContent = '';
                status.className = 'editor-status';
            }
        }

        async function saveFile() {
            if (!currentFile) return;

            const editor = document.getElementById('editor');
            const status = document.getElementById('editor-status');

            status.textContent = 'Speichern...';
            status.className = 'editor-status';

            try {
                await api.put(`/api/help/${currentFile}`, {
                    content: editor.value
                });

                originalContent = editor.value;
                isModified = false;
                status.textContent = 'Gespeichert!';
                status.className = 'editor-status saved';

                // Liste aktualisieren
                loadHelpList();

                setTimeout(() => {
                    status.textContent = '';
                }, 2000);
            } catch (err) {
                status.textContent = 'Fehler: ' + err.message;
                status.className = 'editor-status error';
            }
        }

        function revertFile() {
            if (!confirm('Alle Aenderungen zuruecksetzen?')) return;

            const editor = document.getElementById('editor');
            editor.value = originalContent;
            isModified = false;
            checkModified();
        }

        async function deleteFile() {
            if (!currentFile) return;
            if (!confirm(`"${currentFile}" wirklich loeschen?`)) return;

            try {
                await api.delete(`/api/help/${currentFile}`);
                currentFile = null;
                loadHelpList();
                document.getElementById('help-content').innerHTML = `
                    <div class="no-content">
                        <div class="icon">üìñ</div>
                        <p>Datei geloescht</p>
                    </div>
                `;
            } catch (err) {
                alert('Fehler: ' + err.message);
            }
        }

        async function createNewFile() {
            const input = document.getElementById('new-file-name');
            const name = input.value.trim();

            if (!name) {
                alert('Bitte Name eingeben');
                return;
            }

            try {
                await api.post(`/api/help?name=${encodeURIComponent(name)}`, {
                    content: `# ${name.toUpperCase()}\n\nNeue Dokumentation.\n`
                });

                input.value = '';
                await loadHelpList();
                loadHelpFile(name);
            } catch (err) {
                alert('Fehler: ' + err.message);
            }
        }

        function insertTemplate(type) {
            const editor = document.getElementById('editor');
            if (!editor) return;

            const templates = {
                'heading': '# ',
                'section': '\n== SEKTION ==\n',
                'list': '\n- Punkt 1\n- Punkt 2\n- Punkt 3\n',
                'code': '`code`',
                'note': '\n[HINWEIS] Wichtige Information hier.\n'
            };

            const pos = editor.selectionStart;
            const text = templates[type] || '';

            editor.value = editor.value.slice(0, pos) + text + editor.value.slice(pos);
            editor.focus();
            editor.selectionStart = editor.selectionEnd = pos + text.length;
            checkModified();
        }

        function toggleDevMode() {
            devMode = document.getElementById('dev-mode').checked;
            document.getElementById('new-file-panel').style.display = devMode ? 'block' : 'none';

            // Speichern im localStorage
            localStorage.setItem('help-dev-mode', devMode);

            // Aktuelle Datei neu laden
            if (currentFile) {
                loadHelpFile(currentFile);
            }
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1024 / 1024).toFixed(1) + ' MB';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Search
        document.getElementById('search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();

            if (term.length < 2) {
                renderHelpList(helpFiles);
                return;
            }

            const filtered = helpFiles.filter(f => f.name.toLowerCase().includes(term));
            renderHelpList(filtered);

            if (currentFile) loadHelpFile(currentFile);
        });

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                document.getElementById('search').focus();
            }
        });

        // URL-Filter beim Laden anwenden
        let initialFilter = null;

        function applyInitialFilter() {
            const params = new URLSearchParams(window.location.search);

            // Filter-Parameter (z.B. ?filter=wiki)
            if (params.get('filter') === 'wiki') {
                initialFilter = 'wiki';
                document.querySelector('h1').textContent = 'üìñ Wiki';
                const filtered = helpFiles.filter(f => f.type === 'wiki' || f.type === 'wiki_sub');
                renderHelpList(filtered);
            }

            // Topic-Parameter (z.B. ?topic=startup)
            if (params.has('topic')) {
                setTimeout(() => loadHelpFile(params.get('topic')), 300);
            }
        }

        // Init
        document.addEventListener('DOMContentLoaded', async () => {
            loadStatus();
            await loadHelpList();

            // Dev-Mode aus localStorage laden
            const savedDevMode = localStorage.getItem('help-dev-mode') === 'true';
            if (savedDevMode) {
                document.getElementById('dev-mode').checked = true;
                devMode = true;
                document.getElementById('new-file-panel').style.display = 'block';
            }

            applyInitialFilter();
        });
    </script>
</body>

</html>