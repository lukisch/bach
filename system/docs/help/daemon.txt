# Portabilitaet: SYSTEM
# Zuletzt validiert: 2026-02-08
# Naechste Pruefung: 2026-05-08

DAEMON - Hintergrund-Jobs und Scheduler
=======================================

STAND: 2026-02-08

WICHTIGE POLICY
---------------
**ALLE DAEMON-JOBS SIND STANDARDMAESSIG DEAKTIVIERT.**

Grund: Automatische Prozesse koennen mit aktiven Chat-Sessions
und dem Prompt Generator kollidieren. Jobs werden nur manuell
aktiviert wenn benoetigt.

Der Daemon pausiert automatisch OneDrive-Sync waehrend des Betriebs
um Sync-Konflikte zu vermeiden.

Siehe: docs/CONCEPT_daemon_policy.md

CLI-BEFEHLE
-----------
  bach daemon jobs              Alle Jobs anzeigen
  bach daemon status            Daemon-Status
  bach daemon start [--bg]      Scheduler starten (--bg fuer Hintergrund)
  bach daemon stop              Scheduler stoppen
  bach daemon run <ID>          Einzelnen Job manuell ausfuehren
  bach daemon logs [N]          Letzte Log-Eintraege anzeigen (Standard: 20)

SESSION-SYSTEM
--------------
  bach daemon session start [--profile NAME]   Session-Daemon starten
  bach daemon session stop                     Session-Daemon stoppen
  bach daemon session status                   Session-Status anzeigen
  bach daemon session trigger [--profile NAME] Session manuell ausloesen
  bach daemon session profiles                 Verfuegbare Profile auflisten

  Beispiel mit Dry-Run:
    bach daemon session trigger --profile wartung --dry-run

JOB-TYPEN
---------
  interval    Wiederholung nach Zeitspanne (z.B. 24h, 30m)
  cron        Zeitplan-basiert (z.B. "0 2 * * *" = taeglich 2 Uhr)
  event       Event-basierter Trigger (extern ausgeloest)
  manual      Nur manuell ausfuehrbar
  chain       Verkettete Job-Ausfuehrung (Chain-System)

Der Daemon prueft automatisch alle 5 Minuten auf faellige Recurring Tasks.

VERFUEGBARE JOBS (alle standardmaessig AUS)
-------------------------------------------
Hinweis: Job-Liste ist dynamisch. Aktuelle Jobs via: bach daemon jobs

Beispiel-Jobs:
  ID  Name                      Schedule    Funktion
  --  ------------------------  ----------  --------------------------------
  1   scanner                   60m         Software-Ordner nach Tasks scannen
  2   backup                    24h         Automatisches Backup
  3   inbox-scan                30m         Inbox-Ordner verarbeiten
  4   consolidate-weight        24h         Memory-Gewichtungen (Decay)
  5   consolidate-archive       24h         Alte Eintraege archivieren
  6   consolidate-index         7d          Help/Wiki Index aktualisieren
  7   consolidate-compress      24h         Sessions komprimieren
  8   consolidate-we            7d          Woechentliche Konsolidierung
  9   Nightly Maintenance       cron 0 2    Naechliche Wartungskette
  10  Weekly Backup             cron 0 3 0  Woechentliches Backup

Connector-Jobs (v2.0, via bach connector setup-daemon):
  --  connector_poll_and_route  2m          Connectors pollen + Inbox-Routing
  --  connector_dispatch        1m          Ausgehende Queue mit Retry versenden

JOB MANUELL AUSFUEHREN
----------------------
Empfohlene Methode statt automatischem Scheduler:

  # Job einmalig ausfuehren
  bach daemon run 1         # Scanner einmal laufen lassen
  bach daemon run 2         # Backup einmal erstellen

  # Oder direkt den Befehl
  bach scan run             # Scanner
  bach backup create        # Backup
  bach consolidate run      # Konsolidierung

GUI
---
  http://127.0.0.1:8000/daemon    Daemon-Dashboard

  - Jobs aktivieren/deaktivieren
  - Manuell ausfuehren
  - Letzte Ausfuehrungen sehen

SIEHE AUCH
----------
  docs/CONCEPT_daemon_policy.md   Daemon-Richtlinien
  docs/docs/docs/help/connector.txt              Connector-System (Queue, Retry)
  docs/docs/docs/help/maintain.txt               Wartungs-Tools
  docs/docs/docs/help/backup.txt                 Backup-System
  docs/docs/docs/help/consolidation.txt          Memory-Konsolidierung
