# Portabilitaet: SYSTEM
# Version: 1.0.0
# Zuletzt validiert: 2026-02-28
# Naechste Pruefung: 2026-08-28
# Ressourcen: [hub/scheduler.py, gui/daemon_service.py, daemon_jobs, daemon_runs]

SCHEDULER - Hintergrund-Jobs und Scheduler-Service
====================================================

STAND: 2026-02-28

Hinweis: `bach scheduler ...` ist der neue Name fuer den Scheduler.
Der alte Befehl `bach daemon ...` ist weiterhin als Alias verfuegbar.

WICHTIGE POLICY
---------------
**ALLE SCHEDULER-JOBS SIND STANDARDMAESSIG DEAKTIVIERT.**

Grund: Automatische Prozesse koennen mit aktiven Chat-Sessions
und dem Prompt Generator kollidieren. Jobs werden nur manuell
aktiviert wenn benoetigt.

Der Scheduler pausiert automatisch OneDrive-Sync waehrend des Betriebs
um Sync-Konflikte zu vermeiden.

Siehe: docs/CONCEPT_daemon_policy.md

CLI-BEFEHLE (bach scheduler)
-----------------------------

  jobs              Alle Jobs anzeigen
  status            Scheduler-Status
  start [--bg]      Scheduler-Service starten (--bg fuer Hintergrund)
  stop              Scheduler-Service stoppen
  run <ID>          Einzelnen Job manuell ausfuehren
  logs [N]          Letzte Log-Eintraege anzeigen (Standard: 20)

SESSION-SYSTEM
--------------

  session start [--profile NAME]   Session-Scheduler starten
  session stop                     Session-Scheduler stoppen
  session status                   Session-Status anzeigen
  session trigger [--profile NAME] Session manuell ausloesen
  session profiles                 Verfuegbare Profile auflisten

  Beispiel mit Dry-Run:
    bach scheduler session trigger --profile wartung --dry-run

JOB-TYPEN
---------

  interval    Wiederholung nach Zeitspanne (z.B. 24h, 30m)
  cron        Zeitplan-basiert (z.B. "0 2 * * *" = taeglich 2 Uhr)
  event       Event-basierter Trigger (extern ausgeloest)
  manual      Nur manuell ausfuehrbar
  chain       Verkettete Job-Ausfuehrung (Chain-System)

Der Scheduler prueft automatisch alle 5 Minuten auf faellige Recurring Tasks.

VERFUEGBARE JOBS (alle standardmaessig AUS)
-------------------------------------------
Hinweis: Job-Liste ist dynamisch. Aktuelle Jobs via: bach scheduler jobs

Beispiel-Jobs:
  ID  Name                      Schedule    Funktion
  --  ------------------------  ----------  --------------------------------
  1   scanner                   60m         Software-Ordner nach Tasks scannen
  2   backup                    24h         Automatisches Backup
  3   inbox-scan                30m         Inbox-Ordner verarbeiten
  4   consolidate-weight        24h         Memory-Gewichtungen (Decay)
  5   consolidate-archive       24h         Alte Eintraege archivieren
  6   consolidate-index         7d          Help/Wiki Index aktualisieren
  7   consolidate-compress      24h         Sessions komprimieren
  8   consolidate-we            7d          Woechentliche Konsolidierung
  9   Nightly Maintenance       cron 0 2    Naechliche Wartungskette
  10  Weekly Backup             cron 0 3 0  Woechentliches Backup

Connector-Jobs (v2.0, via bach connector setup-scheduler):
  --  connector_poll_and_route  2m          Connectors pollen + Inbox-Routing
  --  connector_dispatch        1m          Ausgehende Queue mit Retry versenden

JOB MANUELL AUSFUEHREN
----------------------
Empfohlene Methode statt automatischem Scheduler:

  # Job einmalig ausfuehren
  bach scheduler run 1         # Scanner einmal laufen lassen
  bach scheduler run 2         # Backup einmal erstellen

  # Oder direkt den Befehl
  bach scan run                # Scanner
  bach backup create           # Backup
  bach consolidate run         # Konsolidierung

GUI
---
  http://127.0.0.1:8000/scheduler    Scheduler-Dashboard

  - Jobs aktivieren/deaktivieren
  - Manuell ausfuehren
  - Letzte Ausfuehrungen sehen

ALIAS: bach daemon ...
----------------------
Der frueherer Befehlsname `bach daemon` ist weiterhin als Alias
fuer Rueckwaertskompatibilitaet verfuegbar. Beide Befehlsformen
sind aequivalent:

  bach daemon jobs      ==  bach scheduler jobs
  bach daemon status    ==  bach scheduler status
  bach daemon start     ==  bach scheduler start

SIEHE AUCH
----------
  bach --help daemon           Aeltere Dokumentation (Alias)
  docs/CONCEPT_daemon_policy.md    Scheduler-Richtlinien
  bach --help connector        Connector-System (Queue, Retry)
  bach --help maintain         Wartungs-Tools
  bach --help backup           Backup-System
  bach --help consolidation    Memory-Konsolidierung
